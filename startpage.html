<!DOCTYPE html>
<html>
<head>
  <title>Act! Premium Cloud Support Utility | Start Page</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
<script>
    var environmentList = []; //Lists all of the available Jenkins environments
    var pageLoc = "";
    var pageContainer = "";

    // On page load, read /resources/data/jenkinsEnvironments.xml for the list of Jenkins environments that are available to connect to.
    $(document).ready(function(){
        pageLoc = window.location.href;
        pageContainer = pageLoc.substring(0, pageLoc.lastIndexOf('/'));

        loadJenkinsEnvironmentsXml()
    });

    function loadJenkinsEnvironmentsXml() {
        $.ajax({
            type: "GET",
            url: pageContainer + "/resources/data/jenkinsEnvironments.xml",
            async:true,
            dataType: "xml",
            success: (function(data){
                readJenkinsEnvironmentsXml(data);
            })
        });
    }

    function readJenkinsEnvironmentsXml(xmlData){
        $(xmlData).find('environment').each(function(){
            var name = $(this).find("name").text(),
                id = $(this).find("id").text(),
                isProduction = $(this).find("isProduction").text(),
                url = $(this).find("url").text();

            environmentList[environmentList.length] = ({name:name, id:id, isProduction:isProduction, url:url});
        });

        checkConfiguredJenkinsEnvironments();
    }

    function checkConfiguredJenkinsEnvironments() {
        var configuredEnvsHtml = "";

        $(environmentList).each(function(){
            if (localStorage.getItem(this.id + "LoginToken")) {
                configuredEnvsHtml = configuredEnvsHtml + this.name + "<br>";
            }
        })

        $("#configuredServers").html(configuredEnvsHtml);
    }
</script>
<h1>Welcome to the Act! Premium Cloud Support Utility</h1>
<h3>Configured Jenkins servers:</h3>
<p id="configuredServers">
</p>
<button id="configureButton" onclick="location.href = pageContainer + '/jenkinslogin.html';">Configure servers</button>

</body>
</html>
